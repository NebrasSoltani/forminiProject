{% extends 'base.html.twig' %}

{% block title %}RÃ©sultat - {{ quiz.titre }}{% endblock %}

{% block body %}
<div class="container mt-5">
    <div class="mb-4">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ path('apprenant_mes_formations') }}">Mes Formations</a></li>
                <li class="breadcrumb-item"><a href="{{ path('apprenant_suivre_formation', {'id': formation.id}) }}">{{ formation.titre }}</a></li>
                <li class="breadcrumb-item"><a href="{{ path('apprenant_quiz_index', {'formationId': formation.id}) }}">Quiz</a></li>
                <li class="breadcrumb-item active">RÃ©sultat</li>
            </ol>
        </nav>
    </div>

    <!-- RÃ©sultat principal -->
    <div class="card mb-4 {% if resultat.reussi %}border-success{% else %}border-danger{% endif %}">
        <div class="card-header {% if resultat.reussi %}bg-success{% else %}bg-danger{% endif %} text-white">
            <h2 class="mb-0">
                {% if resultat.reussi %}
                    ğŸ‰ FÃ©licitations ! Vous avez rÃ©ussi le quiz !
                {% else %}
                    ğŸ˜” Quiz non rÃ©ussi
                {% endif %}
            </h2>
        </div>
        <div class="card-body text-center">
            <h3 class="display-4 {% if resultat.reussi %}text-success{% else %}text-danger{% endif %}">
                {{ resultat.note }}%
            </h3>
            <p class="text-muted">Note obtenue</p>
            <hr>
            <p class="lead">
                {% if resultat.reussi %}
                    Vous avez obtenu {{ resultat.note }}% au quiz "{{ quiz.titre }}". ğŸ“
                {% else %}
                    Vous avez obtenu {{ resultat.note }}%, la note minimale est {{ quiz.noteMinimale }}%. RÃ©essayez ! ğŸ’ª
                {% endif %}
            </p>
            <p class="text-muted"><small>Quiz passÃ© le {{ resultat.dateTentative|date('d/m/Y Ã  H:i') }}</small></p>
        </div>
    </div>

    <!-- DÃ©tail des rÃ©ponses si correction activÃ©e -->
    {% if quiz.afficherCorrection and detailsReponses %}
        <div class="card mb-4">
            <div class="card-header"><h4>ğŸ“ DÃ©tail de vos rÃ©ponses</h4></div>
            <div class="card-body">
                {% for detail in detailsReponses %}
                    {% set question = quiz.questions[loop.index0] %}
                    {% if question %}
                    <div class="mb-4 pb-3 {% if not loop.last %}border-bottom{% endif %}">
                        <h6>Question {{ loop.index }} :</h6>
                        {% if detail.correct %}
                            <span class="badge bg-success">âœ“ Correct</span>
                        {% else %}
                            <span class="badge bg-danger">âœ— Incorrect</span>
                        {% endif %}
                        <p>{{ question.enonce }}</p>
                        <div class="ms-3">
                            {% for reponse in question.reponses %}
                                <div class="mb-1">
                                    {% if reponse.id == detail.reponse_utilisateur and reponse.id == detail.reponse_correcte %}
                                        <span class="text-success"><strong>âœ“ {{ reponse.texte }}</strong> (Votre rÃ©ponse - Correcte)</span>
                                    {% elseif reponse.id == detail.reponse_utilisateur %}
                                        <span class="text-danger"><strong>âœ— {{ reponse.texte }}</strong> (Votre rÃ©ponse - Incorrecte)</span>
                                    {% elseif reponse.estCorrecte %}
                                        <span class="text-success">âœ“ {{ reponse.texte }} (Bonne rÃ©ponse)</span>
                                    {% else %}
                                        <span class="text-muted">{{ reponse.texte }}</span>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                        {% if question.explication %}
                            <div class="alert alert-info mt-2 mb-0"><small>ğŸ’¡ {{ question.explication }}</small></div>
                        {% endif %}
                    </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    {% endif %}

    <!-- Actions -->
    <div class="d-flex justify-content-between">
        <a href="{{ path('apprenant_quiz_index', {'formationId': formation.id}) }}" class="btn btn-secondary">
            â† Retour aux quiz
        </a>
        {% if not resultat.reussi %}
            <a href="{{ path('apprenant_quiz_passer', {'formationId': formation.id, 'quizId': quiz.id}) }}" class="btn btn-primary">
                ğŸ”„ RÃ©essayer le quiz
            </a>
        {% else %}
            <a href="{{ path('apprenant_suivre_formation', {'id': formation.id}) }}" class="btn btn-success">
                Continuer la formation â†’
            </a>
        {% endif %}
    </div>
</div>
{% endblock %}
