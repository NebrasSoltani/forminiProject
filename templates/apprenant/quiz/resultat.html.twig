{% extends 'base.html.twig' %}

{% block title %}R√©sultat - {{ quiz.titre }}{% endblock %}

{% block body %}
<div class="container mt-5">
    <div class="mb-4">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ path('apprenant_mes_formations') }}">Mes Formations</a></li>
                <li class="breadcrumb-item"><a href="{{ path('apprenant_suivre_formation', {'id': formation.id}) }}">{{ formation.titre }}</a></li>
                <li class="breadcrumb-item"><a href="{{ path('apprenant_quiz_index', {'formationId': formation.id}) }}">Quiz</a></li>
                <li class="breadcrumb-item active">R√©sultat</li>
            </ol>
        </nav>
    </div>

    <!-- R√©sultat principal -->
    <div class="card mb-4 {% if resultat.reussi %}border-success{% else %}border-danger{% endif %}">
        <div class="card-header {% if resultat.reussi %}bg-success{% else %}bg-danger{% endif %} text-white">
            <h2 class="mb-0">
                {% if resultat.reussi %}
                    üéâ F√©licitations ! Vous avez r√©ussi le quiz !
                {% else %}
                    üòî Quiz non r√©ussi
                {% endif %}
            </h2>
        </div>
        <div class="card-body">
            <div class="row text-center">
                <div class="col-md-3">
                    <div class="p-3">
                        <h3 class="display-4 {% if resultat.reussi %}text-success{% else %}text-danger{% endif %}">
                            {{ resultat.note }}%
                        </h3>
                        <p class="text-muted">Note obtenue</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="p-3">
                        <h3 class="display-4">{{ resultat.nombreBonnesReponses }}</h3>
                        <p class="text-muted">Bonnes r√©ponses</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="p-3">
                        <h3 class="display-4">{{ resultat.nombreTotalQuestions }}</h3>
                        <p class="text-muted">Total questions</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="p-3">
                        <h3 class="display-4">{{ quiz.noteMinimale }}%</h3>
                        <p class="text-muted">Note minimale</p>
                    </div>
                </div>
            </div>

            <hr>

            <div class="text-center">
                <p class="lead">
                    {% if resultat.reussi %}
                        Vous avez obtenu {{ resultat.note }}% au quiz "{{ quiz.titre }}". 
                        C'est un excellent r√©sultat ! Continuez comme √ßa ! üéì
                    {% else %}
                        Vous avez obtenu {{ resultat.note }}%, mais la note minimale requise est {{ quiz.noteMinimale }}%. 
                        Ne vous d√©couragez pas, r√©visez les le√ßons et r√©essayez ! üí™
                    {% endif %}
                </p>
                <p class="text-muted">
                    <small>Quiz pass√© le {{ resultat.dateTentative|date('d/m/Y √† H:i') }}</small>
                </p>
            </div>
        </div>
    </div>

    <!-- D√©tail des r√©ponses (si affichage de correction activ√©) -->
    {% if quiz.afficherCorrection and detailsReponses %}
    <div class="card mb-4">
        <div class="card-header">
            <h4 class="mb-0">üìù D√©tail de vos r√©ponses</h4>
        </div>
        <div class="card-body">
            {% for detail in detailsReponses %}
                {% set question = quiz.questions[loop.index0] %}
                {% if question %}
                <div class="mb-4 pb-3 {% if not loop.last %}border-bottom{% endif %}">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <h6>Question {{ loop.index }} :</h6>
                        {% if detail.correct %}
                            <span class="badge bg-success">‚úì Correct</span>
                        {% else %}
                            <span class="badge bg-danger">‚úó Incorrect</span>
                        {% endif %}
                    </div>
                    <p class="mb-2">{{ question.enonce }}</p>
                    
                    <div class="ms-3">
                        {% for reponse in question.reponses %}
                            <div class="mb-1">
                                {% if reponse.id == detail.reponse_utilisateur and reponse.id == detail.reponse_correcte %}
                                    <span class="text-success">
                                        <strong>‚úì {{ reponse.texte }}</strong> (Votre r√©ponse - Correcte)
                                    </span>
                                {% elseif reponse.id == detail.reponse_utilisateur %}
                                    <span class="text-danger">
                                        <strong>‚úó {{ reponse.texte }}</strong> (Votre r√©ponse - Incorrecte)
                                    </span>
                                {% elseif reponse.estCorrecte %}
                                    <span class="text-success">
                                        ‚úì {{ reponse.texte }} (Bonne r√©ponse)
                                    </span>
                                {% else %}
                                    <span class="text-muted">{{ reponse.texte }}</span>
                                {% endif %}
                            </div>
                        {% endfor %}
                    </div>

                    {% if question.explication %}
                        <div class="alert alert-info mt-2 mb-0">
                            <small><strong>üí° Explication :</strong> {{ question.explication }}</small>
                        </div>
                    {% endif %}
                </div>
                {% endif %}
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Actions -->
    <div class="d-flex justify-content-between">
        <a href="{{ path('apprenant_quiz_index', {'formationId': formation.id}) }}" class="btn btn-secondary">
            ‚Üê Retour aux quiz
        </a>
        {% if not resultat.reussi %}
            <a href="{{ path('apprenant_quiz_passer', {'formationId': formation.id, 'quizId': quiz.id}) }}" class="btn btn-primary">
                üîÑ R√©essayer le quiz
            </a>
        {% else %}
            <a href="{{ path('apprenant_suivre_formation', {'id': formation.id}) }}" class="btn btn-success">
                Continuer la formation ‚Üí
            </a>
        {% endif %}
    </div>
</div>
{% endblock %}
