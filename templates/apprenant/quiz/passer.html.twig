{% extends 'base.html.twig' %}

{% block title %}{{ quiz.titre }} - {{ formation.titre }}{% endblock %}

{% block body %}
<div class="container mt-5">
    <div class="mb-4">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ path('apprenant_mes_formations') }}">Mes Formations</a></li>
                <li class="breadcrumb-item"><a href="{{ path('apprenant_suivre_formation', {'id': formation.id}) }}">{{ formation.titre }}</a></li>
                <li class="breadcrumb-item"><a href="{{ path('apprenant_quiz_index', {'formationId': formation.id}) }}">Quiz</a></li>
                <li class="breadcrumb-item active">{{ quiz.titre }}</li>
            </ol>
        </nav>
    </div>

    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            <h2 class="mb-0">üéØ {{ quiz.titre }}</h2>
        </div>
        <div class="card-body">
            {% if quiz.description %}
                <p class="lead">{{ quiz.description }}</p>
            {% endif %}
            
            <div class="row">
                <div class="col-md-4">
                    <p class="mb-1"><strong>‚è±Ô∏è Dur√©e :</strong> {{ quiz.duree }} minutes</p>
                </div>
                <div class="col-md-4">
                    <p class="mb-1"><strong>‚ùì Questions :</strong> {{ questions|length }}</p>
                </div>
                <div class="col-md-4">
                    <p class="mb-1"><strong>üìä Note minimale :</strong> {{ quiz.noteMinimale }}%</p>
                </div>
            </div>

            <div class="alert alert-info mt-3 mb-0">
                <strong>‚ÑπÔ∏è Instructions :</strong>
                <ul class="mb-0 mt-2">
                    <li>Lisez attentivement chaque question</li>
                    <li>S√©lectionnez la r√©ponse qui vous semble correcte</li>
                    <li>Vous devez r√©pondre √† toutes les questions avant de soumettre</li>
                    <li>Une fois soumis, vous ne pourrez plus modifier vos r√©ponses</li>
                </ul>
            </div>
        </div>
    </div>

    <form method="post" action="{{ path('apprenant_quiz_soumettre', {'formationId': formation.id, 'quizId': quiz.id}) }}" id="quiz-form">
        {% for question in questions %}
        <div class="card mb-3">
            <div class="card-header">
                <h5 class="mb-0">Question {{ loop.index }} / {{ questions|length }}</h5>
            </div>
            <div class="card-body">
                <p class="lead">{{ question.enonce }}</p>
                
                <div class="mt-3">
                    {% for reponse in question.reponses %}
                    <div class="form-check mb-2">
                        <input class="form-check-input" 
                               type="radio" 
                               name="reponses[{{ question.id }}]" 
                               id="reponse_{{ reponse.id }}" 
                               value="{{ reponse.id }}"
                               required>
                        <label class="form-check-label" for="reponse_{{ reponse.id }}">
                            {{ reponse.texte }}
                        </label>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endfor %}

        <div class="card border-warning">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h5 class="mb-1">‚ö†Ô∏è √ätes-vous pr√™t √† soumettre vos r√©ponses ?</h5>
                        <p class="text-muted mb-0 small">V√©rifiez que vous avez r√©pondu √† toutes les questions</p>
                    </div>
                    <div>
                        <a href="{{ path('apprenant_quiz_index', {'formationId': formation.id}) }}" 
                           class="btn btn-secondary me-2">
                            Annuler
                        </a>
                        <button type="submit" class="btn btn-primary" id="submit-btn">
                            ‚úì Soumettre mes r√©ponses
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('quiz-form');
    const submitBtn = document.getElementById('submit-btn');

    form.addEventListener('submit', function(e) {
        // V√©rifier que toutes les questions ont une r√©ponse
        const questions = {{ questions|length }};
        let answered = 0;
        
        for (let i = 0; i < questions; i++) {
            const radios = form.querySelectorAll(`input[name^="reponses"]`);
            const groups = {};
            
            radios.forEach(radio => {
                const name = radio.name;
                if (!groups[name]) groups[name] = false;
                if (radio.checked) groups[name] = true;
            });
            
            answered = Object.values(groups).filter(v => v).length;
        }

        if (answered < questions) {
            e.preventDefault();
            alert('Veuillez r√©pondre √† toutes les questions avant de soumettre.');
            return false;
        }

        // Confirmer la soumission
        if (!confirm('√ätes-vous s√ªr de vouloir soumettre vos r√©ponses ? Vous ne pourrez plus les modifier.')) {
            e.preventDefault();
            return false;
        }

        submitBtn.disabled = true;
        submitBtn.innerHTML = '‚è≥ Envoi en cours...';
    });
});
</script>
{% endblock %}
