{% extends 'base.html.twig' %}

{% block title %}Confirmation de paiement{% endblock %}

{% block body %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <!-- Statut du paiement -->
            {% if paiement.statut == 'valide' %}
            <div class="card border-success mb-4">
                <div class="card-header bg-success text-white text-center">
                    <h2 class="mb-0">‚úÖ Paiement valid√© !</h2>
                </div>
                <div class="card-body text-center">
                    <div class="mb-4">
                        <i class="bi bi-check-circle text-success" style="font-size: 5rem;"></i>
                    </div>
                    <h4 class="text-success">Votre paiement a √©t√© valid√© avec succ√®s !</h4>
                    <p class="text-muted">Vous pouvez maintenant acc√©der √† votre formation.</p>
                </div>
            </div>
            {% else %}
            <div class="card border-warning mb-4">
                <div class="card-header bg-warning text-dark text-center">
                    <h2 class="mb-0">‚è≥ Paiement en attente</h2>
                </div>
                <div class="card-body text-center">
                    <div class="mb-4">
                        <i class="bi bi-hourglass-split text-warning" style="font-size: 5rem;"></i>
                    </div>
                    <h4 class="text-warning">Votre paiement est en attente de validation</h4>
                    <p class="text-muted">Nous vous contacterons d√®s que votre paiement sera confirm√©.</p>
                </div>
            </div>
            {% endif %}

            <!-- D√©tails de la transaction -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">üìã D√©tails de la transaction</h5>
                </div>
                <div class="card-body">
                    <div class="row mb-2">
                        <div class="col-6"><strong>R√©f√©rence :</strong></div>
                        <div class="col-6 text-end">
                            <span class="badge bg-primary">{{ paiement.referenceTransaction }}</span>
                        </div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-6"><strong>Formation :</strong></div>
                        <div class="col-6 text-end">{{ paiement.inscription.formation.titre }}</div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-6"><strong>Montant pay√© :</strong></div>
                        <div class="col-6 text-end text-success fw-bold">{{ paiement.montant }} TND</div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-6"><strong>Mode de paiement :</strong></div>
                        <div class="col-6 text-end">
                            {% if paiement.methodePaiement == 'carte' %}
                                üí≥ Carte bancaire
                            {% elseif paiement.methodePaiement == 'mobile_money' %}
                                üì± Mobile Money
                            {% elseif paiement.methodePaiement == 'virement' %}
                                üè¶ Virement bancaire
                            {% else %}
                                üíµ Esp√®ces
                            {% endif %}
                        </div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-6"><strong>Date :</strong></div>
                        <div class="col-6 text-end">{{ paiement.dateCreation|date('d/m/Y √† H:i') }}</div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-6"><strong>Statut :</strong></div>
                        <div class="col-6 text-end">
                            {% if paiement.statut == 'valide' %}
                                <span class="badge bg-success">‚úì Valid√©</span>
                            {% elseif paiement.statut == 'refuse' %}
                                <span class="badge bg-danger">‚úó Refus√©</span>
                            {% elseif paiement.statut == 'annule' %}
                                <span class="badge bg-secondary">Annul√©</span>
                            {% else %}
                                <span class="badge bg-warning">‚è≥ En attente</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Instructions selon le mode de paiement -->
            {% if paiement.statut == 'en_attente' %}
            <div class="alert alert-info">
                <h5><strong>üìå Prochaines √©tapes :</strong></h5>
                {% if paiement.methodePaiement == 'virement' %}
                    <p>Veuillez effectuer le virement bancaire aux coordonn√©es suivantes :</p>
                    <ul>
                        <li><strong>Banque :</strong> Banque Exemple</li>
                        <li><strong>IBAN :</strong> TN59 1234 5678 9012 3456 7890</li>
                        <li><strong>RIB :</strong> 12345678901234567890</li>
                        <li><strong>B√©n√©ficiaire :</strong> Plateforme de Formation</li>
                        <li><strong>R√©f√©rence :</strong> {{ paiement.referenceTransaction }}</li>
                    </ul>
                    <p class="mb-0">Une fois le virement effectu√©, veuillez nous envoyer le justificatif par email.</p>
                {% elseif paiement.methodePaiement == 'especes' %}
                    <p>Le formateur sera contact√© pour organiser le paiement en esp√®ces.</p>
                    <p class="mb-0">Vous recevrez un email avec les coordonn√©es de rendez-vous.</p>
                {% endif %}
            </div>
            {% endif %}

            <!-- Actions -->
            <div class="d-flex justify-content-between mt-4">
                <a href="{{ path('apprenant_mes_formations') }}" class="btn btn-secondary">
                    ‚Üê Mes formations
                </a>
                {% if paiement.statut == 'valide' %}
                <a href="{{ path('apprenant_suivre_formation', {'id': paiement.inscription.formation.id}) }}" class="btn btn-success">
                    üéì Acc√©der √† la formation ‚Üí
                </a>
                {% else %}
                <a href="{{ path('apprenant_dashboard') }}" class="btn btn-primary">
                    Dashboard ‚Üí
                </a>
                {% endif %}
            </div>

            <!-- Re√ßu √† imprimer -->
            {% if paiement.statut == 'valide' %}
            <div class="text-center mt-4">
                <button onclick="window.print()" class="btn btn-outline-secondary">
                    üñ®Ô∏è Imprimer le re√ßu
                </button>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
@media print {
    .btn, .alert {
        display: none !important;
    }
}
</style>
{% endblock %}
