{% extends 'base.html.twig' %}

{% block title %}register{% endblock %}

{% block body %}

<br><br><br>
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h2 class="text-center">Inscription</h2>
                </div>
                <div class="card-body">
                    {{ form_start(registrationForm) }}
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                {{ form_label(registrationForm.nom, 'Nom') }}
                                {{ form_widget(registrationForm.nom, {'attr': {'class': 'form-control'}}) }}
                                {{ form_errors(registrationForm.nom) }}
                            </div>
                            <div class="col-md-6 mb-3">
                                {{ form_label(registrationForm.prenom, 'Prénom') }}
                                {{ form_widget(registrationForm.prenom, {'attr': {'class': 'form-control'}}) }}
                                {{ form_errors(registrationForm.prenom) }}
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                {{ form_label(registrationForm.email, 'Email') }}
                                {{ form_widget(registrationForm.email, {'attr': {'class': 'form-control'}}) }}
                                {{ form_errors(registrationForm.email) }}
                            </div>
                            <div class="col-md-6 mb-3">
                                {{ form_label(registrationForm.telephone, 'Numéro de téléphone') }}
                                {{ form_widget(registrationForm.telephone, {'attr': {'class': 'form-control'}}) }}
                                {{ form_errors(registrationForm.telephone) }}
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                {{ form_label(registrationForm.gouvernorat, 'Gouvernorat') }}
                                {{ form_widget(registrationForm.gouvernorat, {'attr': {'class': 'form-control'}}) }}
                                {{ form_errors(registrationForm.gouvernorat) }}

                            </div>
                            <div class="col-md-6 mb-3">
                                {{ form_label(registrationForm.dateNaissance, 'Date de naissance') }}
                                {{ form_widget(registrationForm.dateNaissance, {'attr': {'class': 'form-control'}}) }}
                                {{ form_errors(registrationForm.dateNaissance) }}
                            </div>
                        </div>

                        <div class="mb-3">
                            {{ form_label(registrationForm.profession, 'Profession') }}
                            {{ form_widget(registrationForm.profession, {'attr': {'class': 'form-control'}}) }}
                            {{ form_errors(registrationForm.profession) }}
                        </div>

                        <div class="mb-3">
                            {{ form_label(registrationForm.photo, 'Photo de profil') }}
                            {{ form_widget(registrationForm.photo, {'attr': {'class': 'form-control'}}) }}
                            {{ form_errors(registrationForm.photo) }}
                        </div>

                        <div class="mb-3">
                            {{ form_label(registrationForm.roleUtilisateur, 'Rôle dans la plateforme') }}
                            {{ form_widget(registrationForm.roleUtilisateur, {'attr': {'class': 'form-control'}}) }}
                            {{ form_errors(registrationForm.roleUtilisateur) }}
                        </div>

                        {# Champs spécifiques pour Formateur #}
                        <div id="formateur-fields" style="display:none;">
                            <h5 class="mt-4 mb-3 text-primary">Informations Formateur</h5>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    {{ form_label(registrationForm.specialite) }}
                                    {{ form_widget(registrationForm.specialite) }}
                                    {{ form_errors(registrationForm.specialite) }}
                                </div>
                                <div class="col-md-6 mb-3">
                                    {{ form_label(registrationForm.experienceAnnees) }}
                                    {{ form_widget(registrationForm.experienceAnnees) }}
                                    {{ form_errors(registrationForm.experienceAnnees) }}
                                </div>
                            </div>
                            <div class="mb-3">
                                {{ form_label(registrationForm.bio) }}
                                {{ form_widget(registrationForm.bio) }}
                                {{ form_errors(registrationForm.bio) }}
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    {{ form_label(registrationForm.linkedin) }}
                                    {{ form_widget(registrationForm.linkedin) }}
                                    {{ form_errors(registrationForm.linkedin) }}
                                </div>
                                <div class="col-md-6 mb-3">
                                    {{ form_label(registrationForm.portfolio) }}
                                    {{ form_widget(registrationForm.portfolio) }}
                                    {{ form_errors(registrationForm.portfolio) }}
                                </div>
                            </div>
                            <div class="mb-3">
                                {{ form_label(registrationForm.cv) }}
                                {{ form_widget(registrationForm.cv) }}
                                {{ form_errors(registrationForm.cv) }}
                            </div>
                        </div>

                        {# Champs spécifiques pour Apprenant #}
                        <div id="apprenant-fields" style="display:none;">
                            <h5 class="mt-4 mb-3 text-success">Informations Apprenant</h5>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    {{ form_label(registrationForm.genre) }}
                                    {{ form_widget(registrationForm.genre) }}
                                    {{ form_errors(registrationForm.genre) }}
                                </div>
                                <div class="col-md-6 mb-3">
                                    {{ form_label(registrationForm.etatCivil) }}
                                    {{ form_widget(registrationForm.etatCivil) }}
                                    {{ form_errors(registrationForm.etatCivil) }}
                                </div>
                            </div>
                            <div class="mb-3">
                                {{ form_label(registrationForm.objectif) }}
                                {{ form_widget(registrationForm.objectif) }}
                                {{ form_errors(registrationForm.objectif) }}
                            </div>
<div class="mb-3">
    {{ form_label(registrationForm.domainesInteret) }}
    {{ form_widget(registrationForm.domainesInteret) }}
    {{ form_errors(registrationForm.domainesInteret) }}
</div>

<div class="mb-3">
    <label for="autreCentreInteret">Autre centre d'intérêt</label>
    <input type="text" id="autreCentreInteret" class="form-control" placeholder="Ajouter un centre d'intérêt">
</div>
 


                        </div>

                        {# Champs spécifiques pour Société #}
                        <div id="societe-fields" style="display:none;">
                            <h5 class="mt-4 mb-3 text-info">Informations Société</h5>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    {{ form_label(registrationForm.nomSociete) }}
                                    {{ form_widget(registrationForm.nomSociete) }}
                                    {{ form_errors(registrationForm.nomSociete) }}
                                </div>
                                <div class="col-md-6 mb-3">
                                    {{ form_label(registrationForm.secteur) }}
                                    {{ form_widget(registrationForm.secteur) }}
                                    {{ form_errors(registrationForm.secteur) }}
                                </div>
                            </div>
                            <div class="mb-3">
                                {{ form_label(registrationForm.descriptionSociete) }}
                                {{ form_widget(registrationForm.descriptionSociete) }}
                                {{ form_errors(registrationForm.descriptionSociete) }}
                            </div>
                            <div class="mb-3">
                                {{ form_label(registrationForm.adresse) }}
                                {{ form_widget(registrationForm.adresse) }}
                                {{ form_errors(registrationForm.adresse) }}
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    {{ form_label(registrationForm.siteWeb) }}
                                    {{ form_widget(registrationForm.siteWeb) }}
                                    {{ form_errors(registrationForm.siteWeb) }}
                                </div>
                                <div class="col-md-6 mb-3">
                                    {{ form_label(registrationForm.logo) }}
                                    {{ form_widget(registrationForm.logo) }}
                                    {{ form_errors(registrationForm.logo) }}
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                {{ form_label(registrationForm.plainPassword.first, 'Mot de passe') }}
                                {{ form_widget(registrationForm.plainPassword.first, {'attr': {'class': 'form-control'}}) }}
                                {{ form_errors(registrationForm.plainPassword.first) }}
                            </div>
                            <div class="col-md-6 mb-3">
                                {{ form_label(registrationForm.plainPassword.second, 'Confirmer mot de passe') }}
                                {{ form_widget(registrationForm.plainPassword.second, {'attr': {'class': 'form-control'}}) }}
                                {{ form_errors(registrationForm.plainPassword.second) }}
                            </div>
                        </div>

                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary btn-lg">S'inscrire</button>
                        </div>

                        <div class="text-center mt-3">
                            <p>Vous avez déjà un compte ? <a href="{{ path('app_login') }}">Se connecter</a></p>
                        </div>
                    {{ form_end(registrationForm) }}
                </div>
            </div>
        </div>
    </div>
</div><script>
document.addEventListener('DOMContentLoaded', function() {
    const roleSelect = document.querySelector('select[name*="roleUtilisateur"]');
    const formateurFields = document.getElementById('formateur-fields');
    const apprenantFields = document.getElementById('apprenant-fields');
    const societeFields = document.getElementById('societe-fields');

    if (!roleSelect) return;

    function showRoleFields() {
        const selectedRole = roleSelect.value;

        // Cacher tous les champs spécifiques
        formateurFields.style.display = 'none';
        apprenantFields.style.display = 'none';
        societeFields.style.display = 'none';

        // Afficher selon le rôle
        if (selectedRole === 'formateur') formateurFields.style.display = 'block';
        else if (selectedRole === 'apprenant') apprenantFields.style.display = 'block';
        else if (selectedRole === 'societe') societeFields.style.display = 'block';
    }

    // Changement du rôle
    roleSelect.addEventListener('change', showRoleFields);

    // Afficher les champs si un rôle est déjà sélectionné (recharge du formulaire)
    showRoleFields();

    // --- Gestion "autre centre d'intérêt" pour apprenant en checklist ---
    const checkboxesContainer = document.querySelector('#apprenant-fields div.form-check-group');
    const autreInput = document.querySelector('input[name*="autreCentreInteret"]');

    if (checkboxesContainer && autreInput) {
        autreInput.addEventListener('blur', function() {
            const value = this.value.trim();
            if (!value) return;

            // Vérifie si la checkbox existe déjà
            const exists = Array.from(checkboxesContainer.querySelectorAll('input[type="checkbox"]'))
                .some(cb => cb.value === value);
            if (!exists) {
                const id = 'domainesInteret_' + value.replace(/\s+/g, '_');

                const div = document.createElement('div');
                div.classList.add('form-check');

                const input = document.createElement('input');
                input.type = 'checkbox';
                input.name = 'registration_form[domainesInteret][]';
                input.value = value;
                input.id = id;
                input.classList.add('form-check-input');
                input.checked = true;

                const label = document.createElement('label');
                label.classList.add('form-check-label');
                label.htmlFor = id;
                label.textContent = value;

                div.appendChild(input);
                div.appendChild(label);
                checkboxesContainer.appendChild(div);
            }
            this.value = '';
        });
    }
});
</script>



{% endblock %}